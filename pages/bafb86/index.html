<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>React | AGAN</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/Agan-blog/img/favicon.ico">
    <meta name="description" content="悠悠的古城中 听美人奏琴声,长枪刺破云霞 放下一生牵挂,舍命奉陪 抵不过天公不作美,遇见即是上上签 纵使结局不如意">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    
    <link rel="preload" href="/Agan-blog/assets/css/0.styles.1674594c.css" as="style"><link rel="preload" href="/Agan-blog/assets/js/app.3c2129f2.js" as="script"><link rel="preload" href="/Agan-blog/assets/js/2.0d86c6dd.js" as="script"><link rel="preload" href="/Agan-blog/assets/js/56.7a3249d2.js" as="script"><link rel="prefetch" href="/Agan-blog/assets/js/10.7078a18d.js"><link rel="prefetch" href="/Agan-blog/assets/js/11.d88f4ce5.js"><link rel="prefetch" href="/Agan-blog/assets/js/12.9421e68f.js"><link rel="prefetch" href="/Agan-blog/assets/js/13.3a1a129a.js"><link rel="prefetch" href="/Agan-blog/assets/js/14.5937ebf2.js"><link rel="prefetch" href="/Agan-blog/assets/js/15.4936127b.js"><link rel="prefetch" href="/Agan-blog/assets/js/16.12136193.js"><link rel="prefetch" href="/Agan-blog/assets/js/17.86fdf534.js"><link rel="prefetch" href="/Agan-blog/assets/js/18.b8319bf1.js"><link rel="prefetch" href="/Agan-blog/assets/js/19.9752074d.js"><link rel="prefetch" href="/Agan-blog/assets/js/20.5410609d.js"><link rel="prefetch" href="/Agan-blog/assets/js/21.49488984.js"><link rel="prefetch" href="/Agan-blog/assets/js/22.b60a0706.js"><link rel="prefetch" href="/Agan-blog/assets/js/23.898fc863.js"><link rel="prefetch" href="/Agan-blog/assets/js/24.fda9bf26.js"><link rel="prefetch" href="/Agan-blog/assets/js/25.895b4cba.js"><link rel="prefetch" href="/Agan-blog/assets/js/26.8dac8683.js"><link rel="prefetch" href="/Agan-blog/assets/js/27.683d24dd.js"><link rel="prefetch" href="/Agan-blog/assets/js/28.efd2334c.js"><link rel="prefetch" href="/Agan-blog/assets/js/29.e77fea17.js"><link rel="prefetch" href="/Agan-blog/assets/js/3.1a398d3a.js"><link rel="prefetch" href="/Agan-blog/assets/js/30.561fc879.js"><link rel="prefetch" href="/Agan-blog/assets/js/31.a4b0f822.js"><link rel="prefetch" href="/Agan-blog/assets/js/32.140f8495.js"><link rel="prefetch" href="/Agan-blog/assets/js/33.078f355e.js"><link rel="prefetch" href="/Agan-blog/assets/js/34.7921c113.js"><link rel="prefetch" href="/Agan-blog/assets/js/35.85b6395d.js"><link rel="prefetch" href="/Agan-blog/assets/js/36.56a6bc9a.js"><link rel="prefetch" href="/Agan-blog/assets/js/37.f94705be.js"><link rel="prefetch" href="/Agan-blog/assets/js/38.ede5f11d.js"><link rel="prefetch" href="/Agan-blog/assets/js/39.440a48e8.js"><link rel="prefetch" href="/Agan-blog/assets/js/4.722a81fa.js"><link rel="prefetch" href="/Agan-blog/assets/js/40.59b0244b.js"><link rel="prefetch" href="/Agan-blog/assets/js/41.c5c79df1.js"><link rel="prefetch" href="/Agan-blog/assets/js/42.b32cc047.js"><link rel="prefetch" href="/Agan-blog/assets/js/43.dcf4204c.js"><link rel="prefetch" href="/Agan-blog/assets/js/44.c3669e78.js"><link rel="prefetch" href="/Agan-blog/assets/js/45.b8c83895.js"><link rel="prefetch" href="/Agan-blog/assets/js/46.d5e11c38.js"><link rel="prefetch" href="/Agan-blog/assets/js/47.6e8e6a17.js"><link rel="prefetch" href="/Agan-blog/assets/js/48.5feb8558.js"><link rel="prefetch" href="/Agan-blog/assets/js/49.0f23f936.js"><link rel="prefetch" href="/Agan-blog/assets/js/5.e1e9fbee.js"><link rel="prefetch" href="/Agan-blog/assets/js/50.3817003e.js"><link rel="prefetch" href="/Agan-blog/assets/js/51.947892ad.js"><link rel="prefetch" href="/Agan-blog/assets/js/52.b3d8699f.js"><link rel="prefetch" href="/Agan-blog/assets/js/53.a56229c5.js"><link rel="prefetch" href="/Agan-blog/assets/js/54.a062f12e.js"><link rel="prefetch" href="/Agan-blog/assets/js/55.49595207.js"><link rel="prefetch" href="/Agan-blog/assets/js/57.6f4387d7.js"><link rel="prefetch" href="/Agan-blog/assets/js/58.0cbc79f7.js"><link rel="prefetch" href="/Agan-blog/assets/js/59.2e2f114c.js"><link rel="prefetch" href="/Agan-blog/assets/js/6.0c2419ec.js"><link rel="prefetch" href="/Agan-blog/assets/js/60.cbae4a83.js"><link rel="prefetch" href="/Agan-blog/assets/js/61.6e70f846.js"><link rel="prefetch" href="/Agan-blog/assets/js/62.f21a405e.js"><link rel="prefetch" href="/Agan-blog/assets/js/63.db589b0d.js"><link rel="prefetch" href="/Agan-blog/assets/js/64.1f95cef9.js"><link rel="prefetch" href="/Agan-blog/assets/js/65.f1408ec1.js"><link rel="prefetch" href="/Agan-blog/assets/js/66.e713aa05.js"><link rel="prefetch" href="/Agan-blog/assets/js/67.3c617fa4.js"><link rel="prefetch" href="/Agan-blog/assets/js/68.d21e34d6.js"><link rel="prefetch" href="/Agan-blog/assets/js/69.31b24de4.js"><link rel="prefetch" href="/Agan-blog/assets/js/7.accc422d.js"><link rel="prefetch" href="/Agan-blog/assets/js/70.cd4f2a03.js"><link rel="prefetch" href="/Agan-blog/assets/js/71.89266fef.js"><link rel="prefetch" href="/Agan-blog/assets/js/72.3307e935.js"><link rel="prefetch" href="/Agan-blog/assets/js/73.5b1aedd1.js"><link rel="prefetch" href="/Agan-blog/assets/js/74.c578d90d.js"><link rel="prefetch" href="/Agan-blog/assets/js/75.65c4c504.js"><link rel="prefetch" href="/Agan-blog/assets/js/76.563a3e33.js"><link rel="prefetch" href="/Agan-blog/assets/js/77.9a401ea8.js"><link rel="prefetch" href="/Agan-blog/assets/js/78.8968edd9.js"><link rel="prefetch" href="/Agan-blog/assets/js/79.e6bc297c.js"><link rel="prefetch" href="/Agan-blog/assets/js/8.977aa7f9.js"><link rel="prefetch" href="/Agan-blog/assets/js/80.803f5cd2.js"><link rel="prefetch" href="/Agan-blog/assets/js/81.0344aa07.js"><link rel="prefetch" href="/Agan-blog/assets/js/82.e830d944.js"><link rel="prefetch" href="/Agan-blog/assets/js/83.9c7bd0a3.js"><link rel="prefetch" href="/Agan-blog/assets/js/84.1d3691d3.js"><link rel="prefetch" href="/Agan-blog/assets/js/85.d0e0eec9.js"><link rel="prefetch" href="/Agan-blog/assets/js/86.7a9b98f1.js"><link rel="prefetch" href="/Agan-blog/assets/js/87.989e4a6a.js"><link rel="prefetch" href="/Agan-blog/assets/js/88.96fb2e84.js"><link rel="prefetch" href="/Agan-blog/assets/js/89.63cf36b0.js"><link rel="prefetch" href="/Agan-blog/assets/js/9.55a60885.js"><link rel="prefetch" href="/Agan-blog/assets/js/90.19849981.js"><link rel="prefetch" href="/Agan-blog/assets/js/91.950b7c76.js"><link rel="prefetch" href="/Agan-blog/assets/js/92.5c148052.js"><link rel="prefetch" href="/Agan-blog/assets/js/93.e926e177.js">
    <link rel="stylesheet" href="/Agan-blog/assets/css/0.styles.1674594c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="ag-container is-page" data-v-1895eed2><div class="ag-header" data-v-312fb2c6 data-v-1895eed2><nav class="ag-nav" data-v-312fb2c6><span data-v-312fb2c6><a href="/Agan-blog/" class="router-link-active" data-v-312fb2c6>首页</a></span><span data-v-312fb2c6><a href="/Agan-blog/pages/d67b9d/" data-v-312fb2c6>设计</a></span><span data-v-312fb2c6><a href="/Agan-blog/pages/8143cc480faf9a11/" data-v-312fb2c6>前端</a></span><span data-v-312fb2c6><a href="/Agan-blog/pages/fe171a/" data-v-312fb2c6>随笔</a></span><span data-v-312fb2c6><a href="/Agan-blog/pages/beb6c0bd8a66cea6" data-v-312fb2c6>收藏夹</a></span><span data-v-312fb2c6><a data-v-312fb2c6>
          其他
          </a></span></nav> <div class="ag-toggle-mode theme-mode" data-v-704e114c data-v-312fb2c6><div class="current-mode" data-v-704e114c>
    自动
  </div> <ul class="select-mode" style="display:none;" data-v-704e114c><li class="light" data-v-704e114c>
      浅色
    </li><li class="dark" data-v-704e114c>
      暗色
    </li><li class="is-active auto" data-v-704e114c>
      自动
    </li></ul></div></div> <div class="ag-body" data-v-1895eed2><div class="ag-slogn" data-v-92e64100 data-v-1895eed2><h1 data-v-92e64100></h1> <h4 data-v-92e64100></h4></div> <div class="ag-page" data-v-a14a39de data-v-1895eed2 data-v-1895eed2><div class="ag-slide-panel ag-side" data-v-302c62e6 data-v-a14a39de><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      计算机相关
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/772077/" data-v-b37a5190>计算机浏览器相关
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/014c11/" data-v-b37a5190>在输入URL之后，浏览器上做了什么
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/392a60/" data-v-b37a5190>「前端进阶必备」深入理解现代浏览器
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/0ae1a6/" data-v-b37a5190> 重排重绘为什么会影响渲染，如何避免
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/450cf0/" data-v-b37a5190>js css 顺序对前端优化影响
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/12cf5b/" data-v-b37a5190> 缓存机制
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/4cde03/" data-v-b37a5190>HTTP, HTTPS, HTTP2 的区别和联系
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/3fb3b0/" data-v-b37a5190>跨域问题
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/0d4c51/" data-v-b37a5190>事件循环
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      HTML
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/17f79a/" data-v-b37a5190> Html
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      CSS
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/2cf44b/" data-v-b37a5190> CSS
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      JS
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/85e0ff/" data-v-b37a5190> Js
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      框架
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/07183b/" data-v-b37a5190> Webpack
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/4a6389/" data-v-b37a5190> Vue
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/bafb86/" aria-current="page" class="router-link-exact-active router-link-active" data-v-b37a5190> React
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      Node
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/c2c1d1/" data-v-b37a5190> Node
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-link" data-v-b37a5190 data-v-302c62e6><a href="/Agan-blog/pages/c15f88/" data-v-b37a5190>性能优化
              </a></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      算法
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/6f88c1/" data-v-b37a5190> 算法
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-link" data-v-b37a5190 data-v-302c62e6><a href="/Agan-blog/pages/7d2fc9/" data-v-b37a5190>一些概念
              </a></div></div></div> <div class="ag-main" data-v-a14a39de><div class="ag-content" data-v-a14a39de><div class="content__default" data-v-a14a39de data-v-a14a39de><h1 id="react"><a href="#react" class="header-anchor">#</a> React</h1> <p>[TOC]</p> <h2 id="_1-生命周期"><a href="#_1-生命周期" class="header-anchor">#</a> 1 生命周期</h2> <h3 id="_1-1-单个组件的生命周期"><a href="#_1-1-单个组件的生命周期" class="header-anchor">#</a> 1.1 单个组件的生命周期</h3> <p>按照创建，更新，销毁的顺序</p> <ol><li>componentwillMount(React17 废弃)</li> <li>componentDidMount</li> <li>componentWillReceiveProps(React17 替换成 getDerivedStateFromProps)</li> <li>shouldComponentUpdate</li> <li>componentWillUpdate(React17 替换成 getSnapshotBeforeUpdate)</li> <li>componentDidUpdate</li> <li>componentWillUnmount</li></ol> <p>其他：</p> <ul><li>错误捕获 componendDidCatch</li></ul> <h3 id="_1-2-父子组件的生命周期"><a href="#_1-2-父子组件的生命周期" class="header-anchor">#</a> 1.2 父子组件的生命周期</h3> <p>大致和 Vue 相同，不同的是，react 没有局部更新，更新父组件的同时也会更新子组件。</p> <p>父 componentWillMount -&gt; 子 componentWillMount -&gt; 子 componentDidMount -&gt; 父 componentDidMount</p> <ul><li>销毁：</li></ul> <p>父 componentWillUnmount -&gt; 子 componentWillUnmount</p> <ul><li>更新
<ul><li>只更新子： 子 shouldComponentUpdate -&gt; 子 componentWillUpdate -&gt; 子 componentDidUpdate</li> <li>更新父或同时更新：父 shouldComponentUpdate -&gt; 父 componentWillUpdate -&gt; ==子 componentWillReceiveProps== -&gt; 子 shouldComponentUpdate -&gt; 子 componentWillUpdate -&gt; 子 componentDidUpdate -&gt; 父 componentDidUpdate</li></ul></li></ul> <h3 id="_1-3-react17-生命周期改动"><a href="#_1-3-react17-生命周期改动" class="header-anchor">#</a> 1.3 react17 生命周期改动</h3> <ul><li>componentWillMount</li> <li>componentWillRecieveProps</li> <li>componentWIllUpdate</li></ul> <p>简单来说就是这三个生命周期函数容易被误解并滥用，可能会对异步渲染造成潜在的问题。 可用 UNSAFE_xxx 来取消 eslint 的报错。</p> <p>新增三个生命周期</p> <ul><li>getDerivedStateFromProps(nextProps, prevState)</li></ul> <p><strong>静态方法，所以不能使用 this.setState。</strong> 用于替换 componentWillReceiveProps，可以用来控制 props 更新 state 的过程；它返回一个对象表示新的 state；如果不需要更新，返回 null 即可</p> <ul><li>getSnapshotBeforeUpdate(nextProps, prevState) 。用于替换 componentWillUpdate</li> <li>componendDidCatch(error, info)。 新增，用于捕捉错误</li></ul> <h2 id="_2-react-的通信方式"><a href="#_2-react-的通信方式" class="header-anchor">#</a> 2 react 的通信方式</h2> <ul><li>props</li> <li>context。 可跨级通信，但不知道来源哪里不推荐使用。基于生产者消费者模式</li> <li>redux 和 react-redux</li> <li>用 js 实现发布订阅模式</li> <li>React17 会废弃 childContext 使用新 API - createContext()，并提供 Provider 和 consumer 组件，类似 Vue</li></ul> <h2 id="_3-setstate"><a href="#_3-setstate" class="header-anchor">#</a> 3 setState</h2> <p>setState 是 React 组件中用于更新数据和触发渲染的函数，他的用法如下</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span>newState<span class="token operator">:</span>object <span class="token operator">|</span> updater<span class="token operator">:</span> Function<span class="token punctuation">,</span> callback<span class="token operator">?</span><span class="token punctuation">)</span>

<span class="token function-variable function">updater</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">state<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

</code></pre></div><h3 id="_3-1-同步和异步-setstate"><a href="#_3-1-同步和异步-setstate" class="header-anchor">#</a> 3.1 同步和异步 setState</h3> <p><strong>何时同步，何时异步？</strong></p> <ul><li>在 react 的生命周期勾子或 react 事件监听回调中使用</li> <li>其他情况，如定时器回调，原生事件监听回调，promise 回调</li></ul> <p><strong>为什么 setState 是异步的？</strong></p> <p>setState 出发 React 的更新生命周期函数 4 个函数：shouldComponentUpdate，componentWillUpdate，render，componentDidUpdate。如果每一次 setState 调用都走一圈生命周期，并拿 render 函数返回的结果会拿去做 Virtual DOM 比较和更新 DOM 树，这个就比较费时间。</p> <p>目前 React 会将 setState 的效果放在队列中，积攒着一次引发更新过程。为的就是把 Virtual DOM 和 DOM 树操作降到最小，用于提高性能。</p> <h3 id="_3-2-setstate-如何实现"><a href="#_3-2-setstate-如何实现" class="header-anchor">#</a> 3.2 setState 如何实现</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token class-name">ReactComponent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">setState</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">partialState<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 更新的操作会放在数组里</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>updater<span class="token punctuation">.</span><span class="token function">enqueueSetState</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> partialState<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>updater<span class="token punctuation">.</span><span class="token function">enqueueCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> callback<span class="token punctuation">,</span> <span class="token string">'setState'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>总体流程如下：</p> <ol><li>将 state 放入 enqueueSetState 队列中，并调用 enqueueUpdate 处理要更新的 Component</li> <li>如果组件当前正处于 update 中(isBatchingUpdates)，则先将 Component 存入 dirtyComponent 中。否则调用 batchedUpdates 处理。</li> <li>batchedUpdates 发起一次 transaction.perform()事务</li> <li>事务会更新 isBatchingUpdates 为 false，循环遍历所有的 dirtyComponents，调用 updateComponent 刷新组件，并执行它的 pendingCallbacks, 也就是 setState 中设置的 callback。</li></ol> <h2 id="_4-react-的事件机制"><a href="#_4-react-的事件机制" class="header-anchor">#</a> 4 react 的事件机制</h2> <h3 id="_4-1-合成事件"><a href="#_4-1-合成事件" class="header-anchor">#</a> 4.1 合成事件</h3> <p>在 react 中使用 jsx 语法绑定的事件并不是原生事件，而是一种合成事件 SyntheticEvent。例如 SyntheticEvent, SyntheticKeyboardEvent, SyntheticFocusEvent 等。他有以下特点：</p> <ul><li>默认的事件流是冒泡，如果以捕获的方式来触发事件的话，事件类型后面加一个后缀 Capture</li> <li>几乎所有的事件代理(delegate)到 document，达到性能优化的目的，例如对于 audio、video 标签，存在一些媒体事件(例如 onplay、onpause)，只能在这些标签上进行事件绑定，绑定一个入口分发函数(dispatchEvent)</li> <li>对于每种类型的事件，拥有统一的分发函数 dispatchEvent</li> <li>事件对象(event)是合成对象(SyntheticEvent)，不是原生的。所以 e.stopPropagation()方法阻止的知识合成事件流的传播。</li></ul> <h3 id="_4-2-如何实现"><a href="#_4-2-如何实现" class="header-anchor">#</a> 4.2 如何实现</h3> <p>React 事件机制分为事件注册，和事件分发，两个部分。</p> <ul><li>组件加载 (mountComponent)、更新 (updateComponent) 的时候，调用 _updateDOMProperties 方法对 props 进行处理，将事件绑定在 document 上，并存储在 EventPluginHub 中（订阅发布中心）</li> <li>回调统一是 ReactEventListener 的 dispatch 方法。通过_dispatchListeners 里得到所有绑定的回调函数，然后循环执行里面的所有的回调函数</li></ul> <h2 id="_5-react16"><a href="#_5-react16" class="header-anchor">#</a> 5 react16</h2> <ol><li>新的核心算法 Fiber</li> <li>render 可以返回数组，字符串</li> <li>错误处理机制</li> <li>Portals 组件 渲染外部的 dom 节点. createPortal API</li> <li>更好 更快的服务端渲染 rendertoNodeStream 返回 node 的流</li> <li>体积更小 MIT 协议</li></ol> <h2 id="_6-fiber"><a href="#_6-fiber" class="header-anchor">#</a> 6 Fiber</h2> <p>Fiber 可以提升复杂 React 应用的可响应性和性能。Fiber 即是 React 新的调度算法。</p> <ul><li>每次有 state 的变化 React 重新计算，如果计算量过大，浏览器主线程来不及做其他的事情，比如 rerender 或者 layout，那例如动画就会出现卡顿现象。</li> <li>React 制定了一种名为 Fiber 的数据结构，加上新的算法，使得大量的计算可以被拆解，异步化，浏览器主线程得以释放，保证了渲染的帧率。从而提高响应性。</li> <li>React 将更新分为了两个时期：
<ul><li>render/reconciliation: 可打断，React 在 workingProgressTree 上复用 current 上的 Fiber 数据结构来一步地（通过 requestIdleCallback）来构建新的 tree，标记处需要更新的节点，放入队列中。</li> <li>commit: 不可打断。在第二阶段，React 将其所有的变更一次性更新到 DOM 上。</li></ul></li></ul> <h2 id="_7-函数式组件-class-组件-受控组件-高级组件的概念"><a href="#_7-函数式组件-class-组件-受控组件-高级组件的概念" class="header-anchor">#</a> 7 函数式组件，class 组件，受控组件，高级组件的概念</h2> <ul><li>class 组件：类组件不仅允许你使用更多额外的功能，如组件自身的状态和生命周期钩子，也能使组件直接访问 store 并维持状态</li> <li>函数式组件：当组件仅是接收 props，并将组件自身渲染到页面时，该组件就是一个 '无状态组件(stateless component)'，可以使用一个纯函数来创建这样的组件,即函数式组件</li> <li>受控组件：在 HTML 中，类似 input, textarea 和 select 这样的表单元素会维护自身的状态，并基于用户的输入来更新。一个输入表单元素，它的值通过 React 的这种方式来控制，这样的元素就被称为&quot;受控元素&quot;。</li> <li>高级组件 HOC：高阶组件是一个以组件为参数并返回一个新组件的函数，例如 redux 的 connect 函数</li></ul> <h2 id="_8-react-router"><a href="#_8-react-router" class="header-anchor">#</a> 8 react-router</h2> <h3 id="_8-1-路由模式"><a href="#_8-1-路由模式" class="header-anchor">#</a> 8.1 路由模式</h3> <ul><li>BrowserHistory：h5 历史模式</li> <li>HashHistory：h5 hash 模式</li> <li>MemoryHistory：和 abstract 模式类似</li> <li>StaticRouter：一个永远不会改变位置的<code>&lt;Router&gt;</code>。这在服务器端渲染场景中非常有用</li> <li>NativeRouter：RN 使用</li></ul> <h2 id="_9-redux"><a href="#_9-redux" class="header-anchor">#</a> 9 redux</h2> <h3 id="_9-1-基本概念"><a href="#_9-1-基本概念" class="header-anchor">#</a> 9.1 基本概念</h3> <ul><li>state: 数据，即状态</li> <li>Action: 一个纯对象，携带这个操作的类型和数据信息</li> <li>Action Creater: 一个函数，根据指定参数，来生成一个 Action，目的是减少代码量</li> <li>Reducer: 一个纯函数，用来修改应用的状态，接收当前 State 和 Action，返回一个新的 State。
<ul><li>不得改写参数</li> <li>不得调用系统的 I/O 的 API</li> <li>不得调用 Date.now()或者 Math.random()等不纯的方法，因为每次得到的结果会不一样</li> <li>不能改变 State，必须返回一个新的对象，具体可以使用{...obj}运算符或者 Object.assign()来操作</li></ul></li> <li>combineReducers: 一个函数，将多个小的 Reducer 合并成一个大的 Reducer</li> <li>Store: 数据存储中心
<ul><li>Store.getState() 获取 Store 当前的状态</li> <li>Store.dispatch() 分派一个 Action，用来修改 Store 的状态，从 View 中发出 Action 的唯一方法</li> <li>Store.subscribe() 订阅一个监听器，当 Store 的状态发生改变的时候，执行函数</li></ul></li> <li>Middlewares: 中间件, 中间件实际上就是一个拦截器，本质是一个函数，拦截所有的 Action，并执行特定的操作
<ul><li>compose 函数，将[f1, f2, f3] =&gt; f1(f2(f3(x)))</li></ul></li></ul> <h3 id="_9-2-数据流"><a href="#_9-2-数据流" class="header-anchor">#</a> 9.2 数据流</h3> <p>Redux 应用中数据的生命周期遵循下面 4 个步骤：</p> <ol><li>调用 store.dispatch(action)。</li> <li>Redux store 调用传入的 reducer 函数。</li> <li>根 reducer 应该把多个子 reducer 输出合并成一个单一的 state 树。</li> <li>Redux store 保存了根 reducer 返回的完整 state 树。</li></ol> <p><img src="https://gitee.com/zukunft/MDImage/raw/master/img/20200902003659.png" alt="Redux"></p> <blockquote><p>官网地址：<a href="https://www.redux.org.cn/docs/basics/DataFlow.html" target="_blank" rel="noopener noreferrer">www.redux.org.cn/docs/basics…<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="_10-react-应用"><a href="#_10-react-应用" class="header-anchor">#</a> 10 react 应用</h2> <h3 id="_10-1-实现一个简单的-redux"><a href="#_10-1-实现一个简单的-redux" class="header-anchor">#</a> 10.1 实现一个简单的 redux</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//数据中心 和 发布订阅调度中心</span>
<span class="token comment">/**
 * 生成状态树
 * @param {*} reducer 纯函数 接受dispatch的action,对state进行操作
 * @param {*} enhancer 增强器，中间件
 */</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token parameter">reducer<span class="token punctuation">,</span> enhancer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>enhancer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">enhancer</span><span class="token punctuation">(</span>createStore<span class="token punctuation">)</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> state <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">let</span> listeners <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token keyword">function</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">listener</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> listener <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'listeners should be a function'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    listeners<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    state <span class="token operator">=</span> <span class="token function">reducer</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
    listeners<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> action
  <span class="token punctuation">}</span>

  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">'@@zty/redux/init'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 初始化数据</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span> getState<span class="token punctuation">,</span> subscribe<span class="token punctuation">,</span> dispatch <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// addGun = dispatch(addGun())</span>
<span class="token keyword">function</span> <span class="token function">bindActionCreator</span><span class="token punctuation">(</span><span class="token parameter">creator<span class="token punctuation">,</span> dispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">creator</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// creators = {addGun, removeGun}</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">bindActionCreators</span><span class="token punctuation">(</span><span class="token parameter">creators<span class="token punctuation">,</span> dispatch</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>creators<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> k</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">bindActionCreator</span><span class="token punctuation">(</span>creators<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> dispatch<span class="token punctuation">)</span>
    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// [f1, f2, f3] = f1(f2(f3()))</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>funs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>funs<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> f
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>funs<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> funs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> funs<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res<span class="token punctuation">,</span> fun</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">res</span><span class="token punctuation">(</span><span class="token function">fun</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 添加中间件</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">applyMiddleware</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>middlewares</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">createStore</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
    <span class="token keyword">let</span> dispatch <span class="token operator">=</span> store<span class="token punctuation">.</span>dispatch

    <span class="token keyword">const</span> midApi <span class="token operator">=</span> <span class="token punctuation">{</span>
      getState<span class="token operator">:</span> store<span class="token punctuation">.</span>getState<span class="token punctuation">,</span>
      <span class="token function-variable function">dispatch</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> middlewaresChain <span class="token operator">=</span> middlewares<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">mw</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">mw</span><span class="token punctuation">(</span>midApi<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// [f1, f2, f3] =&gt; f1(f2(f3))  形成中间件链路</span>
    dispatch <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token operator">...</span>middlewaresChain<span class="token punctuation">)</span><span class="token punctuation">(</span>store<span class="token punctuation">.</span>dispatch<span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>store<span class="token punctuation">,</span>
      dispatch<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div data-v-a14a39de></div></div></div></div></div> <div cclass="ag-footer-warp" data-v-1895eed2><div class="ag-footer" data-v-3078f227 data-v-1895eed2><div data-v-3078f227>余 年</div> <div class="supporting" data-v-3078f227>-</div> <div class="supporting" data-v-3078f227>距离2022年还剩下  天</div></div></div></div><div class="global-ui"></div></div>
    <script src="/Agan-blog/assets/js/app.3c2129f2.js" defer></script><script src="/Agan-blog/assets/js/2.0d86c6dd.js" defer></script><script src="/Agan-blog/assets/js/56.7a3249d2.js" defer></script>
  </body>
</html>
