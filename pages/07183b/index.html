<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Webpack | AGAN</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/Agan-blog/img/favicon.ico">
    <meta name="description" content="悠悠的古城中 听美人奏琴声,长枪刺破云霞 放下一生牵挂,舍命奉陪 抵不过天公不作美,遇见即是上上签 纵使结局不如意">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    
    <link rel="preload" href="/Agan-blog/assets/css/0.styles.1674594c.css" as="style"><link rel="preload" href="/Agan-blog/assets/js/app.3c2129f2.js" as="script"><link rel="preload" href="/Agan-blog/assets/js/2.0d86c6dd.js" as="script"><link rel="preload" href="/Agan-blog/assets/js/54.a062f12e.js" as="script"><link rel="prefetch" href="/Agan-blog/assets/js/10.7078a18d.js"><link rel="prefetch" href="/Agan-blog/assets/js/11.d88f4ce5.js"><link rel="prefetch" href="/Agan-blog/assets/js/12.9421e68f.js"><link rel="prefetch" href="/Agan-blog/assets/js/13.3a1a129a.js"><link rel="prefetch" href="/Agan-blog/assets/js/14.5937ebf2.js"><link rel="prefetch" href="/Agan-blog/assets/js/15.4936127b.js"><link rel="prefetch" href="/Agan-blog/assets/js/16.12136193.js"><link rel="prefetch" href="/Agan-blog/assets/js/17.86fdf534.js"><link rel="prefetch" href="/Agan-blog/assets/js/18.b8319bf1.js"><link rel="prefetch" href="/Agan-blog/assets/js/19.9752074d.js"><link rel="prefetch" href="/Agan-blog/assets/js/20.5410609d.js"><link rel="prefetch" href="/Agan-blog/assets/js/21.49488984.js"><link rel="prefetch" href="/Agan-blog/assets/js/22.b60a0706.js"><link rel="prefetch" href="/Agan-blog/assets/js/23.898fc863.js"><link rel="prefetch" href="/Agan-blog/assets/js/24.fda9bf26.js"><link rel="prefetch" href="/Agan-blog/assets/js/25.895b4cba.js"><link rel="prefetch" href="/Agan-blog/assets/js/26.8dac8683.js"><link rel="prefetch" href="/Agan-blog/assets/js/27.683d24dd.js"><link rel="prefetch" href="/Agan-blog/assets/js/28.efd2334c.js"><link rel="prefetch" href="/Agan-blog/assets/js/29.e77fea17.js"><link rel="prefetch" href="/Agan-blog/assets/js/3.1a398d3a.js"><link rel="prefetch" href="/Agan-blog/assets/js/30.561fc879.js"><link rel="prefetch" href="/Agan-blog/assets/js/31.a4b0f822.js"><link rel="prefetch" href="/Agan-blog/assets/js/32.140f8495.js"><link rel="prefetch" href="/Agan-blog/assets/js/33.078f355e.js"><link rel="prefetch" href="/Agan-blog/assets/js/34.7921c113.js"><link rel="prefetch" href="/Agan-blog/assets/js/35.85b6395d.js"><link rel="prefetch" href="/Agan-blog/assets/js/36.56a6bc9a.js"><link rel="prefetch" href="/Agan-blog/assets/js/37.f94705be.js"><link rel="prefetch" href="/Agan-blog/assets/js/38.ede5f11d.js"><link rel="prefetch" href="/Agan-blog/assets/js/39.440a48e8.js"><link rel="prefetch" href="/Agan-blog/assets/js/4.722a81fa.js"><link rel="prefetch" href="/Agan-blog/assets/js/40.59b0244b.js"><link rel="prefetch" href="/Agan-blog/assets/js/41.c5c79df1.js"><link rel="prefetch" href="/Agan-blog/assets/js/42.b32cc047.js"><link rel="prefetch" href="/Agan-blog/assets/js/43.dcf4204c.js"><link rel="prefetch" href="/Agan-blog/assets/js/44.c3669e78.js"><link rel="prefetch" href="/Agan-blog/assets/js/45.b8c83895.js"><link rel="prefetch" href="/Agan-blog/assets/js/46.d5e11c38.js"><link rel="prefetch" href="/Agan-blog/assets/js/47.6e8e6a17.js"><link rel="prefetch" href="/Agan-blog/assets/js/48.5feb8558.js"><link rel="prefetch" href="/Agan-blog/assets/js/49.0f23f936.js"><link rel="prefetch" href="/Agan-blog/assets/js/5.e1e9fbee.js"><link rel="prefetch" href="/Agan-blog/assets/js/50.3817003e.js"><link rel="prefetch" href="/Agan-blog/assets/js/51.947892ad.js"><link rel="prefetch" href="/Agan-blog/assets/js/52.b3d8699f.js"><link rel="prefetch" href="/Agan-blog/assets/js/53.a56229c5.js"><link rel="prefetch" href="/Agan-blog/assets/js/55.49595207.js"><link rel="prefetch" href="/Agan-blog/assets/js/56.7a3249d2.js"><link rel="prefetch" href="/Agan-blog/assets/js/57.6f4387d7.js"><link rel="prefetch" href="/Agan-blog/assets/js/58.0cbc79f7.js"><link rel="prefetch" href="/Agan-blog/assets/js/59.2e2f114c.js"><link rel="prefetch" href="/Agan-blog/assets/js/6.0c2419ec.js"><link rel="prefetch" href="/Agan-blog/assets/js/60.cbae4a83.js"><link rel="prefetch" href="/Agan-blog/assets/js/61.6e70f846.js"><link rel="prefetch" href="/Agan-blog/assets/js/62.f21a405e.js"><link rel="prefetch" href="/Agan-blog/assets/js/63.db589b0d.js"><link rel="prefetch" href="/Agan-blog/assets/js/64.1f95cef9.js"><link rel="prefetch" href="/Agan-blog/assets/js/65.f1408ec1.js"><link rel="prefetch" href="/Agan-blog/assets/js/66.e713aa05.js"><link rel="prefetch" href="/Agan-blog/assets/js/67.3c617fa4.js"><link rel="prefetch" href="/Agan-blog/assets/js/68.d21e34d6.js"><link rel="prefetch" href="/Agan-blog/assets/js/69.31b24de4.js"><link rel="prefetch" href="/Agan-blog/assets/js/7.accc422d.js"><link rel="prefetch" href="/Agan-blog/assets/js/70.cd4f2a03.js"><link rel="prefetch" href="/Agan-blog/assets/js/71.89266fef.js"><link rel="prefetch" href="/Agan-blog/assets/js/72.3307e935.js"><link rel="prefetch" href="/Agan-blog/assets/js/73.5b1aedd1.js"><link rel="prefetch" href="/Agan-blog/assets/js/74.c578d90d.js"><link rel="prefetch" href="/Agan-blog/assets/js/75.65c4c504.js"><link rel="prefetch" href="/Agan-blog/assets/js/76.563a3e33.js"><link rel="prefetch" href="/Agan-blog/assets/js/77.9a401ea8.js"><link rel="prefetch" href="/Agan-blog/assets/js/78.8968edd9.js"><link rel="prefetch" href="/Agan-blog/assets/js/79.e6bc297c.js"><link rel="prefetch" href="/Agan-blog/assets/js/8.977aa7f9.js"><link rel="prefetch" href="/Agan-blog/assets/js/80.803f5cd2.js"><link rel="prefetch" href="/Agan-blog/assets/js/81.0344aa07.js"><link rel="prefetch" href="/Agan-blog/assets/js/82.e830d944.js"><link rel="prefetch" href="/Agan-blog/assets/js/83.9c7bd0a3.js"><link rel="prefetch" href="/Agan-blog/assets/js/84.1d3691d3.js"><link rel="prefetch" href="/Agan-blog/assets/js/85.d0e0eec9.js"><link rel="prefetch" href="/Agan-blog/assets/js/86.7a9b98f1.js"><link rel="prefetch" href="/Agan-blog/assets/js/87.989e4a6a.js"><link rel="prefetch" href="/Agan-blog/assets/js/88.96fb2e84.js"><link rel="prefetch" href="/Agan-blog/assets/js/89.63cf36b0.js"><link rel="prefetch" href="/Agan-blog/assets/js/9.55a60885.js"><link rel="prefetch" href="/Agan-blog/assets/js/90.19849981.js"><link rel="prefetch" href="/Agan-blog/assets/js/91.950b7c76.js"><link rel="prefetch" href="/Agan-blog/assets/js/92.5c148052.js"><link rel="prefetch" href="/Agan-blog/assets/js/93.e926e177.js">
    <link rel="stylesheet" href="/Agan-blog/assets/css/0.styles.1674594c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="ag-container is-page" data-v-1895eed2><div class="ag-header" data-v-312fb2c6 data-v-1895eed2><nav class="ag-nav" data-v-312fb2c6><span data-v-312fb2c6><a href="/Agan-blog/" class="router-link-active" data-v-312fb2c6>首页</a></span><span data-v-312fb2c6><a href="/Agan-blog/pages/d67b9d/" data-v-312fb2c6>设计</a></span><span data-v-312fb2c6><a href="/Agan-blog/pages/8143cc480faf9a11/" data-v-312fb2c6>前端</a></span><span data-v-312fb2c6><a href="/Agan-blog/pages/fe171a/" data-v-312fb2c6>随笔</a></span><span data-v-312fb2c6><a href="/Agan-blog/pages/beb6c0bd8a66cea6" data-v-312fb2c6>收藏夹</a></span><span data-v-312fb2c6><a data-v-312fb2c6>
          其他
          </a></span></nav> <div class="ag-toggle-mode theme-mode" data-v-704e114c data-v-312fb2c6><div class="current-mode" data-v-704e114c>
    自动
  </div> <ul class="select-mode" style="display:none;" data-v-704e114c><li class="light" data-v-704e114c>
      浅色
    </li><li class="dark" data-v-704e114c>
      暗色
    </li><li class="is-active auto" data-v-704e114c>
      自动
    </li></ul></div></div> <div class="ag-body" data-v-1895eed2><div class="ag-slogn" data-v-92e64100 data-v-1895eed2><h1 data-v-92e64100></h1> <h4 data-v-92e64100></h4></div> <div class="ag-page" data-v-a14a39de data-v-1895eed2 data-v-1895eed2><div class="ag-slide-panel ag-side" data-v-302c62e6 data-v-a14a39de><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      计算机相关
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/772077/" data-v-b37a5190>计算机浏览器相关
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/014c11/" data-v-b37a5190>在输入URL之后，浏览器上做了什么
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/392a60/" data-v-b37a5190>「前端进阶必备」深入理解现代浏览器
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/0ae1a6/" data-v-b37a5190> 重排重绘为什么会影响渲染，如何避免
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/450cf0/" data-v-b37a5190>js css 顺序对前端优化影响
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/12cf5b/" data-v-b37a5190> 缓存机制
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/4cde03/" data-v-b37a5190>HTTP, HTTPS, HTTP2 的区别和联系
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/3fb3b0/" data-v-b37a5190>跨域问题
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/0d4c51/" data-v-b37a5190>事件循环
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      HTML
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/17f79a/" data-v-b37a5190> Html
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      CSS
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/2cf44b/" data-v-b37a5190> CSS
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      JS
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/85e0ff/" data-v-b37a5190> Js
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      框架
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/07183b/" aria-current="page" class="router-link-exact-active router-link-active" data-v-b37a5190> Webpack
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/4a6389/" data-v-b37a5190> Vue
              </a></div></li><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/bafb86/" data-v-b37a5190> React
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      Node
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/c2c1d1/" data-v-b37a5190> Node
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-link" data-v-b37a5190 data-v-302c62e6><a href="/Agan-blog/pages/c15f88/" data-v-b37a5190>性能优化
              </a></div></div><div class="slide-item" data-v-302c62e6><div class="slide-group" data-v-b37a5190 data-v-302c62e6><div class="slide-title" data-v-b37a5190>
      算法
    </div> <ul class="slide-menus" style="display:none;" data-v-b37a5190 data-v-b37a5190><li class="slide-menu" data-v-b37a5190><div class="slide-link" data-v-b37a5190 data-v-b37a5190><a href="/Agan-blog/pages/6f88c1/" data-v-b37a5190> 算法
              </a></div></li></ul></div></div><div class="slide-item" data-v-302c62e6><div class="slide-link" data-v-b37a5190 data-v-302c62e6><a href="/Agan-blog/pages/7d2fc9/" data-v-b37a5190>一些概念
              </a></div></div></div> <div class="ag-main" data-v-a14a39de><div class="ag-content" data-v-a14a39de><div class="content__default" data-v-a14a39de data-v-a14a39de><h1 id="webpack"><a href="#webpack" class="header-anchor">#</a> Webpack</h1> <p>[TOC]</p> <h2 id="_1-简介"><a href="#_1-简介" class="header-anchor">#</a> 1 简介</h2> <p>本质上，webpack 是一个现代 JavaScript 应用程序的静态模块打包器(module bundler)。当 webpack 处理应用程序时，它会递归地构建一个依赖关系图(dependency graph)，其中包含应用程序需要的每个模块，然后将所有这些模块打包成一个或多个 bundle.</p> <h2 id="_2-核心概念"><a href="#_2-核心概念" class="header-anchor">#</a> 2 核心概念</h2> <ul><li>入口(entry)</li></ul> <p>指示 webpack 应该使用哪个模块，来作为构建其内部依赖图的开始。进入入口起点后，webpack 会找出有哪些模块和库是入口起点（直接和间接）依赖的。</p> <p>可以通过在 webpack 配置中配置 entry 属性，来指定一个入口起点（或多个入口起点）。默认值为 ./src。</p> <ul><li>输出(output)</li></ul> <p>output 属性告诉 webpack 在哪里输出它所创建的 bundles，以及如何命名这些文件，默认值为 ./dist。基本上，整个应用程序结构，都会被编译到你指定的输出路径的文件夹中。你可以通过在配置中指定一个 output 字段，来配置这些处理过程</p> <ul><li>loader</li></ul> <p>loader 让 webpack 能够去处理那些非 JavaScript 文件（webpack 自身只理解 JavaScript）。loader 可以将所有类型的文件转换为 webpack 能够处理的有效模块</p> <p>在更高层面，在 webpack 的配置中 loader 有两个目标：</p> <ul><li>test 属性，用于标识出应该被对应的 loader 进行转换的某个或某些文件。</li> <li>use 属性，表示进行转换时，应该使用哪个 loader。</li></ul> <p>注意：Webpack 选择了 compose 方式，即从右到左执行 loader</p> <p>插件(plugins)</p> <p>插件的范围包括，从打包优化和压缩，一直到重新定义环境中的变量。插件接口功能极其强大，可以用来处理各种各样的任务。</p> <p>plugins 需要暴露出一个 class, 在 new WebpackPlugin()的时候通过构造函数传入这个插件需要的参数，在 webpack 启动的时候会先实例化 plugin 再调用 plugin 的 apply 方法，插件需要在 apply 函数里监听 webpack 生命周期里的事件，做相应的处理</p> <p>模式(mode)</p> <p>通过选择 development 或 production 之中的一个，来设置 mode 参数，你可以启用相应模式下的 webpack 内置的优化</p> <p>简单例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 多个入口</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    index<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/index.js&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    main<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;./src/main.js&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">'js/[name].[hash:8].js'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 正则匹配文件名</span>
      exclude<span class="token operator">:</span> <span class="token string">'/node_modules/'</span><span class="token punctuation">,</span> <span class="token comment">// 排除</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'babel-loader'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 插件</span>
    <span class="token keyword">new</span> <span class="token class-name">copyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
      <span class="token keyword">from</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'public/static'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      to<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      ignore<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'index.html'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="_3-基本流程"><a href="#_3-基本流程" class="header-anchor">#</a> 3 基本流程</h2> <ol><li>解析 shell 和 config 中的配置项，用于激活 webpack 的加载项和插件</li> <li>webpack 初始化工作，包括构建 compiler 对象，初始化 compiler 的上下文，loader 和 file 的输入输出环境</li> <li>解析入口 js 文件，通过对应的工厂方法创建模块，使用 acron 生成 AST 树并且遍历 AST，处理 require 的 module，如果依赖中包含依赖则遍历 build module，在遍历过程中会根据文件类型和 loader 配置找出合适的 loader 用来对文件进行转换</li> <li>调用 seal 方法，封装，逐次对每一个 module，chunk 进行整理，生成编辑后的代码</li></ol> <h2 id="_4-模块打包"><a href="#_4-模块打包" class="header-anchor">#</a> 4 模块打包</h2> <ol><li>通过 fs 将模块读取成字符串，然后用 warp 包裹一下，使之成为一个字符串形式的的函数然后调用 vm.runInNewContext 这样类型的方法，这个字符串会变成一个函数。</li> <li>这些模块的函数会被存放在数组里，然后进行解析执行。module 和 export 都是传入的对象，webpack 会实现 require 函数，去加载其他模块。</li> <li>如果是<strong>异步模块</strong>，则会通过 jsonp 的形式去加载该模块打包好生成的 chunk。 异步加载模块可以使用 import 和 require.ensure 函数，函数将会返回一个 promise。</li> <li>上面方法都是公共的，可以抽离成模板的 js 文件，webpack 负责做依赖分析，并将模块读成函数填充入数组。（这里说的只是 js 的模块）</li></ol> <p>下面附上简易版的代码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//同步模块</span>
<span class="token keyword">var</span> moduleDepList <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token string">'./moduleA'</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// module[0] 的依赖 他依赖moduleA 且 moduleA的下标在moduleList 中 为 1</span>
  <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> parentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentModlueId <span class="token operator">=</span>
    parentId <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> moduleDepList<span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">:</span> id
  <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span> exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token keyword">var</span> moduleFunc <span class="token operator">=</span> moduleList<span class="token punctuation">[</span>currentModlueId<span class="token punctuation">]</span>
  <span class="token function">moduleFunc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">require</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> currentModlueId<span class="token punctuation">)</span><span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span>
  <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//异步模块</span>
<span class="token keyword">var</span> cache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

window<span class="token punctuation">.</span><span class="token function-variable function">__jsonp</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunkId<span class="token punctuation">,</span> moduleFunc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> chunk <span class="token operator">=</span> cache<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span>
  <span class="token keyword">var</span> resolve <span class="token operator">=</span> chunk<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  <span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span> exports<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token function">moduleFunc</span><span class="token punctuation">(</span>require<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

require<span class="token punctuation">.</span><span class="token function-variable function">ensure</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">chunkId<span class="token punctuation">,</span> parentId</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentModlueId <span class="token operator">=</span>
    parentId <span class="token operator">!==</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> moduleDepList<span class="token punctuation">[</span>parentId<span class="token punctuation">]</span><span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">:</span> chunkId
  <span class="token keyword">var</span> currentChunk <span class="token operator">=</span> cache<span class="token punctuation">[</span>currentModlueId<span class="token punctuation">]</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentChunk <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> $script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span>
    $script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">chunk.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>chunkId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.js</span><span class="token template-punctuation string">`</span></span>
    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>$script<span class="token punctuation">)</span>

    <span class="token keyword">var</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> chunkCache <span class="token operator">=</span> <span class="token punctuation">[</span>resolve<span class="token punctuation">]</span> <span class="token comment">// 数组形式是为了保存promise</span>
      chunkCache<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 异步模块加载中 如果有别的包 在 异步加载在模块 那么下面的</span>
      cache<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span> <span class="token operator">=</span> chunkCache
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    cache<span class="token punctuation">[</span>chunkId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>promise<span class="token punctuation">)</span>
    <span class="token keyword">return</span> promise
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>currentChunk<span class="token punctuation">.</span>status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> currentChunk<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token comment">// 这里的promise 这里的就直接返回promise 这样模块只会加载一次</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> currentChunk
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-热更新"><a href="#_5-热更新" class="header-anchor">#</a> 5 热更新</h2> <ol><li>client 和 server 建立一个 websocket 通信</li> <li>当有文件发生变动（如 fs.watchFile）的时候，webpack 编译文件，并通过 websocket 向 client 发送一条更新消息</li> <li>client 根据收到的 hash 值，通过 ajax 获取一个 manifest 描述文件</li> <li>client 根据 manifest 获取新的 JS 模块的代码</li> <li>当取到新的 JS 代码之后，会更新 modules tree，（installedModules)调用之前通过 module.hot.accept 注册好的回调，可能是 loader 提供的，也可能是你自己写的</li></ol> <p>manifest: 描述资源文件对应关系如下，打包后的文件拥有了 hash 值，所以需要进行映射。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;a.js&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a.41231243.js&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_6-plugin"><a href="#_6-plugin" class="header-anchor">#</a> 6 plugin</h2> <h3 id="_6-1-如何开发一个-plugin"><a href="#_6-1-如何开发一个-plugin" class="header-anchor">#</a> 6.1 如何开发一个 plugin</h3> <ol><li>一个 JavaScript 命名函数。</li> <li>在插件函数的 prototype 上定义一个 apply 方法。</li> <li>指定一个绑定到 webpack 自身的事件钩子。</li> <li>处理 webpack 内部实例的特定数据。</li> <li>功能完成后调用 webpack 提供的回调。</li></ol> <p>tapable 工具，它提供了 webpack 插件接口的支柱</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 一个 JavaScript 命名函数。</span>
<span class="token keyword">function</span> <span class="token function">plugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 在插件函数的 prototype 上定义一个 `apply` 方法。</span>
plugin<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">apply</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 指定一个挂载到 webpack 自身的事件钩子。</span>
  compiler<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'webpacksEventHook'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 使用taptable的写法</span>
  <span class="token comment">//基本写法</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>someHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
  <span class="token comment">//如果希望在entry配置完毕后执行某个功能</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>entryOption<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
  <span class="token comment">//如果希望在生成的资源输出到output指定目录之前执行某个功能</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><blockquote><p>官网地址：<a href="https://www.webpackjs.com/api/plugins/" target="_blank" rel="noopener noreferrer">www.webpackjs.com/api/plugins…<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="_6-2-compiler-和-compliation-对象和钩子"><a href="#_6-2-compiler-和-compliation-对象和钩子" class="header-anchor">#</a> 6.2 Compiler 和 Compliation 对象和钩子</h3> <p>对象</p> <ul><li>compiler 对象代表了完整的 webpack 环境配置。这个对象在启动 webpack 时被一次性建立，并配置好所有可操作的设置，包括 options，loader 和 plugin。</li> <li>compilation 对象代表了一次资源版本构建。当运行 webpack 开发环境中间件时，每当检测到一个文件变化，就会创建一个新的 compilation，从而生成一组新的编译资源。一个 compilation 对象表现了当前的模块资源、编译生成资源、变化的文件、以及被跟踪依赖的状态信息。compilation 对象也提供了很多关键时机的回调，以供插件做自定义处理时选择使用</li></ul> <p>钩子：总体分成两大类：Compiler 和 Compliation</p> <ul><li>Compiler 暴露了和 webpack 整个生命周期相关的钩子</li> <li>Compilation 暴露了与模块和依赖有关的粒度更小的事件钩子，官方文档中的说法是模块会经历加载(loaded),封存(sealed),优化(optimized),分块(chunked),哈希(hashed)和重新创建(restored)这几个典型步骤，从上面的示例可以看到，compilation 是 Compiler 生命周期中的一个步骤，使用 compilation 相关钩子的通用写法为:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'SomePlugin'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">compilation<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    compilation<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>someOtherHook<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'SomeOtherPlugin'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token operator">...</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_6-3-钩子的类型"><a href="#_6-3-钩子的类型" class="header-anchor">#</a> 6.3 钩子的类型</h3> <p>同步钩子</p> <ul><li>syncHook: 不关心返回值</li> <li>syncBailHook: 有一个返回值不为 null 就跳过剩下的逻辑</li> <li>SyncWaterfallHook: 下一个任务要拿到上一个任务的返回值</li> <li>SyncLoopHook: 监听函数返回 true 表示继续循环，返回 undefine 表示结束循环</li></ul> <p>异步钩子</p> <ul><li>AsyncParallelHook: 异步并发执行，仍是单线程</li> <li>AsyncParallelBailHook: 异步并发执行，有一个失败了，其他的都不用走了</li> <li>AsyncSeriesHook: 异步串行执行</li> <li>AsyncSeriesBailHook: 异步串行执行，有一个返回值不为 null 就跳过剩下的逻辑</li> <li>AsyncSeriesWaterfallHook: 异步串行执行，下一个任务要拿到上一个任务的返回值</li></ul> <h2 id="_7-常见-plugin"><a href="#_7-常见-plugin" class="header-anchor">#</a> 7 常见 plugin</h2> <ul><li><p>clean-webpack-plugin: 在构建之前删除上一次 build 的文件夹</p></li> <li><p>copy-webpack-plugin: 复制文件或文件夹到生成后的目录</p></li> <li><p>extract-text-webpack | mini-css-extract-plugin: 将所有入口的 chunk(entry chunks)中引用的 *.css，移动到独立分离的 CSS 文件</p></li> <li><p>html-webpack-plugin: 将 build 后生成的资源以标签的形式嵌入到 HTML 模板内</p></li> <li><p>hot-module-replacement: 模块热更新</p></li></ul> <h2 id="_8-常见-loader"><a href="#_8-常见-loader" class="header-anchor">#</a> 8 常见 loader</h2> <ul><li><p>babel-loader: 语法，源码转换以便能够运行在当前和旧版本的浏览器或其他环境中</p></li> <li><p>css-loader: 配合 style-loader 可以解析在 js 中引入的 css 文件，并以<code>&lt;style&gt;</code>标签将 css-loader 内部样式注入到我们的 HTML 页面</p></li> <li><p>file-loader: 可以解析 js 中 require 的文件，输出到输出目录并返回 public URL</p></li> <li><p>html-loader: 可以对 HTML 模板中指定哪个标签属性组合(tag-attribute combination)元素应该被此 loader 处理</p></li> <li><p>less-loader: 依赖 less，可以将 less 编译成 css</p></li> <li><p>postcss-loader: 配合一些 plugin 如 cssnano,autoprefixer 可以对 css 进行压缩，优化，自动补足前缀等</p></li> <li><p>scss-loader: 配合 node-scss，可以将 scss 编译成 css</p></li> <li><p>style-loader: 配合 css-loader 可以解析在 js 中引入的 css 文件，并以<code>&lt;style</code>&gt;标签将 css-loader 内部样式注入到我们的 HTML 页面</p></li> <li><p>url-loader: url-loader 功能类似于 file-loader，但是在文件大小（单位 byte）低于指定的限制时，可以返回一个 DataURL(base64)</p></li></ul> <h2 id="_9-常见打包优化"><a href="#_9-常见打包优化" class="header-anchor">#</a> 9 常见打包优化</h2> <ul><li>使用 dll</li> <li>移除 prefetch， preload，关闭 sourceMap</li> <li>webpack-bundle-analyzer 打包分析，将大的模块可能的移至 CDN。打包时间分析使用 speed-measure-webpack-plugin</li> <li>开启 gzip，服务器需要支持</li> <li>使用多线程：thread-loader 或 HappyPack</li> <li>webpack4 内置的 terser 启动多线程压缩</li> <li>对项目进行拆分</li></ul> <blockquote><p>推荐文章：<a href="https://blog.csdn.net/lunahaijiao/article/details/104509446/" target="_blank" rel="noopener noreferrer">blog.csdn.net/lunahaijiao…<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <div data-v-a14a39de></div></div></div></div></div> <div cclass="ag-footer-warp" data-v-1895eed2><div class="ag-footer" data-v-3078f227 data-v-1895eed2><div data-v-3078f227>余 年</div> <div class="supporting" data-v-3078f227>-</div> <div class="supporting" data-v-3078f227>距离2022年还剩下  天</div></div></div></div><div class="global-ui"></div></div>
    <script src="/Agan-blog/assets/js/app.3c2129f2.js" defer></script><script src="/Agan-blog/assets/js/2.0d86c6dd.js" defer></script><script src="/Agan-blog/assets/js/54.a062f12e.js" defer></script>
  </body>
</html>
